import os, numpy as np, trimesh as tm

obj = "fungia_scutaria"
mesh_path = f"models/ycb/{obj}/google_16k/nontextured.ply"   # your coral mesh path
assert os.path.exists(mesh_path), f"Missing mesh at {mesh_path}"

m = tm.load(mesh_path, force='mesh')
if not isinstance(m, tm.Trimesh):
    # some files load as Scene; merge to single mesh
    m = tm.util.concatenate(m.dump())

# choose a COM estimate: try mass properties; fallback to vertex mean
try:
    com = m.center_mass
    if not np.all(np.isfinite(com)):
        com = m.vertices.mean(axis=0)
except Exception:
    com = m.vertices.mean(axis=0)

com = np.asarray(com, dtype=np.float32)

# write/update models/coms/coms.npz
path = "models/coms/coms.npz"
if os.path.exists(path):
    d = dict(np.load(path, allow_pickle=True)["com_dict"].item())
else:
    d = {}
d[obj] = com
os.makedirs("pose_info", exist_ok=True)
np.savez(path, com_dict=d)

print(f"{obj} COM:", com, "-> wrote", path)
